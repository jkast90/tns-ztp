services:
  ztp-server:
    build: .
    container_name: ztp-server
    hostname: ztp-server
    networks:
      ztp-net:
        ipv4_address: 172.30.0.2
    ports:
      - "8080:8080"
    volumes:
      - ztp-data:/data
      - ztp-tftp:/tftp
      - ztp-backups:/backups
      - ./configs/templates:/configs/templates:ro
    cap_add:
      - NET_ADMIN
    environment:
      - DB_PATH=/data/ztp.db
      - TFTP_DIR=/tftp
      - BACKUP_DIR=/backups
      - TEMPLATES_DIR=/configs/templates
    restart: unless-stopped

  test-client:
    build:
      context: ./test-client
      dockerfile: Dockerfile
    container_name: ztp-test-client
    hostname: test-switch
    networks:
      ztp-net:
        ipv4_address: 172.30.0.99
    mac_address: "02:42:ac:1e:00:99"
    cap_add:
      - NET_ADMIN
    depends_on:
      - ztp-server
    profiles:
      - test

networks:
  ztp-net:
    driver: bridge
    ipam:
      config:
        - subnet: 172.30.0.0/24
          gateway: 172.30.0.1

volumes:
  ztp-data:
  ztp-tftp:
  ztp-backups:
